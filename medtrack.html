<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MedTrack Pro</title>
  <style>
    :root { --ios-blue: #007aff; --ios-bg: #f2f2f7; }
    body { 
      font-family: -apple-system, sans-serif; background: #a2c2e1; 
      display: flex; justify-content: center; padding: 20px;
    }
    .glass {
      background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px);
      border-radius: 20px; border: 1px solid rgba(255,255,255,0.3);
      padding: 25px; width: 100%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    input, button { 
      width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: none; font-size: 16px;
    }
    button { background: var(--ios-blue); color: white; font-weight: 600; cursor: pointer; transition: 0.3s; }
    button:active { transform: scale(0.98); opacity: 0.8; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th { text-align: left; opacity: 0.6; padding-bottom: 10px; }
    td { padding: 10px 0; border-bottom: 0.5px solid rgba(0,0,0,0.1); }
    .hidden { display: none; }
    .progress-container { background: #ddd; height: 8px; border-radius: 4px; margin: 15px 0; }
    #progressFill { background: #34c759; height: 100%; width: 0%; border-radius: 4px; transition: 1s; }
  </style>
</head>
<body>

  <div id="loginCard" class="glass">
    <h1 style="text-align:center">MedTrack Pro</h1>
    <input type="text" id="name" placeholder="Full Name">
    <input type="tel" id="mobile" placeholder="Mobile Number">
    <button onclick="handleLogin()">Sign In</button>
  </div>

  <div id="mainUI" class="glass hidden">
    <h2 id="userGreet">Welcome</h2>
    <div class="progress-container"><div id="progressFill"></div></div>
    <p id="stats">Ready to study?</p>
    
    <table>
      <thead><tr><th>Chapter</th><th>Notes</th><th>Qns</th><th>Count</th><th>Rev</th></tr></thead>
      <tbody id="tableBody"></tbody>
    </table>
    <button onclick="saveAll()" id="saveBtn" style="margin-top:20px;">Save to Cloud</button>
  </div>

  <script>
    // PASTE YOUR GOOGLE APPS SCRIPT URL HERE
    const API_URL = "https://script.google.com/macros/s/AKfycbzfsasIqUCmEeIfp1IKkRtJ9plQeB4QMlK3jhf9z9wsiiTE0NZEKuwHKdfZHccrbKZkxQ/exec";
    
    let userKey = "";
    const chapters = [
      {s: 'Bio', n: 'Living World'}, {s: 'Phy', n: 'Units & Measure'}, {s: 'Che', n: 'Mole Concept'}
    ];

    async function handleLogin() {
      const name = document.getElementById('name').value;
      const mobile = document.getElementById('mobile').value;
      if(!name || !mobile) return alert("Enter details");

      const res = await fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'login', name, mobile })
      });
      const data = await res.json();
      userKey = data.userKey;
      
      document.getElementById('loginCard').classList.add('hidden');
      document.getElementById('mainUI').classList.remove('hidden');
      document.getElementById('userGreet').innerText = "Hi, " + name;
      renderTable(data.progress);
    }

    function renderTable(savedData) {
      const body = document.getElementById('tableBody');
      body.innerHTML = "";
      chapters.forEach(ch => {
        const rowData = savedData.find(r => r[1] === ch.n) || [];
        body.innerHTML += `
          <tr>
            <td><b>${ch.n}</b></td>
            <td><input type="checkbox" class="c-note" ${rowData[3]?'checked':''}></td>
            <td><input type="checkbox" class="c-qns" ${rowData[4]?'checked':''}></td>
            <td><input type="number" class="c-count" value="${rowData[5]||0}" style="width:40px"></td>
            <td><input type="checkbox" class="c-rev" ${rowData[6]?'checked':''}></td>
          </tr>`;
      });
      updateScore();
    }

    async function saveAll() {
      const btn = document.getElementById('saveBtn');
      btn.innerText = "Saving...";
      const dataRows = [];
      document.querySelectorAll('#tableBody tr').forEach(tr => {
        dataRows.push([
          userKey, 
          tr.cells[0].innerText, 
          "Subject",
          tr.querySelector('.c-note').checked,
          tr.querySelector('.c-qns').checked,
          tr.querySelector('.c-count').value,
          tr.querySelector('.c-rev').checked,
          0 // Rating placeholder
        ]);
      });

      await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'save', userKey, data: dataRows })});
      btn.innerText = "Saved!";
      updateScore();
      setTimeout(() => btn.innerText = "Save to Cloud", 2000);
    }

    function updateScore() {
      const total = chapters.length * 3;
      const done = document.querySelectorAll('input[type="checkbox"]:checked').length;
      const pc = Math.round((done/total)*100);
      document.getElementById('progressFill').style.width = pc + "%";
      document.getElementById('stats').innerText = `Total Readiness: ${pc}%`;
    }
  </script>
</body>
</html>
